LAMMPS (29 Oct 2020)
# Compute elastic constant tensor for a crystal

# =======================Initialization
# Define variables
variable up equal 0.03
variable cfac equal 1.0e-4
variable cunits string GPa

variable etol equal 0.0
variable ftol equal 1.0e-10
variable maxiter equal 100
variable maxeval equal 1000
variable dmax equal 1.0e-2

units           metal
boundary        p p p

# Define crystal
variable latparam equal 2.843877166
lattice         bcc ${latparam} orient x 0 0 1 orient y 1 0 0 orient z 0 1 0
lattice         bcc 2.843877166 orient x 0 0 1 orient y 1 0 0 orient z 0 1 0
Lattice spacing in x,y,z = 2.8438772 2.8438772 2.8438772
region          box block 0 1 0 1 0 1 units lattice
create_box      1 box
Created orthogonal box = (0.0000000 0.0000000 0.0000000) to (2.8438772 2.8438772 2.8438772)
  1 by 1 by 1 MPI processor grid
create_atoms    1 box
Created 2 atoms
  create_atoms CPU = 0.000 seconds

mass 1 55.845

# ==========================Potential file

#pair_style eam/fs
#pair_coeff * * /home/lorenzo/Desktop/lammps_gnn_new-impl/testing/models/Fe_2.eam.fs Fe

#pair_style	gnn DimeNet 5.0 3.5 128 1 7 8 7 6 -3460.825847482401 0.16576383029449013
#pair_coeff	* * /home/lorenzo/Desktop/lammps_gnn_new-impl/testing/models/dimenet.pt 1 26

pair_style	gnn DimeNet 5.0 3.5 128 1 7 8 7 6 -3460.825847482401 0.16576383029449515
pair_coeff	* * /home/lorenzo/Desktop/lammps_gnn_new-impl/testing/models/dimenet_nopbc.pt 1 26

# Setup neighbor style
#neighbor 1.0 nsq
#neigh_modify once no every 1 delay 0 check yes
#neighbor        2.0 bin
#neigh_modify    delay 0 check yes page 100000

thermo          1
thermo_style custom step temp pe press pxx pyy pzz pxy pxz pyz lx ly lz vol
run 0
WARNING: No fixes defined, atoms won't move (../verlet.cpp:54)
Neighbor list info ...
  update every 1 steps, delay 10 steps, check yes
  max neighbors/atom: 2000, page size: 100000
  master list distance cutoff = 7
  ghost atom cutoff = 7
  binsize = 3.5, bins = 1 1 1
  1 neighbor lists, perpetual/occasional/extra = 1 0 0
  (1) pair gnn, perpetual
      attributes: full, newton on, ghost, cut 5.0
      pair build: full/bin/ghost
      stencil: full/ghost/bin/3d
      bin: standard
Per MPI rank memory allocation (min/avg/max) = 2.983 | 2.983 | 2.983 Mbytes
Step Temp PotEng Press Pxx Pyy Pzz Pxy Pxz Pyz Lx Ly Lz Volume 
       0            0   -6921.6774    106818.95    106818.95    106818.95    106818.95    106818.95    106818.95    106818.95    2.8438772    2.8438772    2.8438772    23.000247 
Loop time of 9.53674e-07 on 1 procs for 0 steps with 2 atoms

838.9% CPU use with 1 MPI tasks x no OpenMP threads

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 0          | 0          | 0          |   0.0 |  0.00
Neigh   | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 0          | 0          | 0          |   0.0 |  0.00
Output  | 0          | 0          | 0          |   0.0 |  0.00
Modify  | 0          | 0          | 0          |   0.0 |  0.00
Other   |            | 9.537e-07  |            |       |100.00

Nlocal:        2.00000 ave           2 max           2 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:        339.000 ave         339 max         339 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:        0.00000 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:      116.000 ave         116 max         116 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 116
Ave neighs/atom = 58.000000
Neighbor list builds = 0
Dangerous builds = 0
variable tmp equal pxx
variable pxx0 equal ${tmp}
variable pxx0 equal 106818.953947133
variable tmp equal lx
variable lx0 equal ${tmp}
variable lx0 equal 2.843877166
variable tmp equal pe
variable pe0 equal ${tmp}
variable pe0 equal -6921.67744782372

# These formulas define the derivatives w.r.t. strain components
# Constants uses $, variables use v_
variable d1 equal -(v_pxx1-${pxx0})/(v_delta/v_len0)*${cfac}
variable d1 equal -(v_pxx1-106818.953947133)/(v_delta/v_len0)*${cfac}
variable d1 equal -(v_pxx1-106818.953947133)/(v_delta/v_len0)*0.0001

dump 1 all custom 1 dump x y z fx fy fz
# ==========================uxx Perturbation
variable len0 equal ${lx0}
variable len0 equal 2.843877166
variable delta equal ${up}*${len0}
variable delta equal 0.03*${len0}
variable delta equal 0.03*2.843877166
change_box all x delta 0 ${delta} remap units box
change_box all x delta 0 0.08531631498 remap units box
Changing box ...
  orthogonal box = (0.0000000 0.0000000 0.0000000) to (2.9291935 2.8438772 2.8438772)

min_style cg
minimize ${etol} ${ftol} ${maxiter} ${maxeval}
minimize 0 ${ftol} ${maxiter} ${maxeval}
minimize 0 1e-10 ${maxiter} ${maxeval}
minimize 0 1e-10 100 ${maxeval}
minimize 0 1e-10 100 1000
WARNING: Using 'neigh_modify every 1 delay 0 check yes' setting during minimization (../min.cpp:187)
Per MPI rank memory allocation (min/avg/max) = 5.359 | 5.359 | 5.359 Mbytes
Step Temp PotEng Press Pxx Pyy Pzz Pxy Pxz Pyz Lx Ly Lz Volume 
       0            0   -6921.6737    50769.314    91764.692    30271.625    30271.625    31179.773    31179.773    30271.625    2.9291935    2.8438772    2.8438772    23.690255 
       1            0   -6921.6737    50769.314    91764.692    30271.625    30271.625    31179.773    31179.773    30271.625    2.9291935    2.8438772    2.8438772    23.690255 
Loop time of 37.5784 on 1 procs for 1 steps with 2 atoms

582.5% CPU use with 1 MPI tasks x no OpenMP threads

Minimization stats:
  Stopping criterion = linesearch alpha is zero
  Energy initial, next-to-last, final = 
     -6921.67374489892  -6921.67374489892  -6921.67374489892
  Force two-norm initial, final = 1.4535948 1.4535948
  Force max component initial, final = 0.92643919 0.92643919
  Final line search alpha, max atom move = 3.2168676e-09 2.9802322e-09
  Iterations, force evaluations = 1 28

MPI task timing breakdown:
Section |  min time  |  avg time  |  max time  |%varavg| %total
---------------------------------------------------------------
Pair    | 37.578     | 37.578     | 37.578     |   0.0 |100.00
Neigh   | 0          | 0          | 0          |   0.0 |  0.00
Comm    | 0.0002141  | 0.0002141  | 0.0002141  |   0.0 |  0.00
Output  | 0          | 0          | 0          |   0.0 |  0.00
Modify  | 0          | 0          | 0          |   0.0 |  0.00
Other   |            | 0.0005538  |            |       |  0.00

Nlocal:        2.00000 ave           2 max           2 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Nghost:        339.000 ave         339 max         339 min
Histogram: 1 0 0 0 0 0 0 0 0 0
Neighs:        0.00000 ave           0 max           0 min
Histogram: 1 0 0 0 0 0 0 0 0 0
FullNghs:      116.000 ave         116 max         116 min
Histogram: 1 0 0 0 0 0 0 0 0 0

Total # of neighbors = 116
Ave neighs/atom = 58.000000
Neighbor list builds = 0
Dangerous builds = 0




variable tmp equal pxx
variable pxx1 equal ${tmp}
variable pxx1 equal 91764.6922949947

variable C11 equal ${d1}
variable C11 equal 50.1808721737943

#-------------------second way to compute C11----------
# get current potential energy
variable tmp equal pe
variable pe1 equal ${tmp}
variable pe1 equal -6921.67374489892

# get the box size
variable tmp equal lx
variable lx1 equal ${tmp}
variable lx1 equal 2.92919348098
variable tmp equal ly
variable ly1 equal ${tmp}
variable ly1 equal 2.843877166
variable tmp equal lz
variable lz1 equal ${tmp}
variable lz1 equal 2.843877166

# get the energy difference
variable delta_pe equal ${pe1}-${pe0}
variable delta_pe equal -6921.67374489892-${pe0}
variable delta_pe equal -6921.67374489892--6921.67744782372

# compute the elastic constant by using the definition from total energy
variable eVAngs3_to_GPa equal 160.21766208
variable volume_now equal ${lx1}*${ly1}*${lz1}
variable volume_now equal 2.92919348098*${ly1}*${lz1}
variable volume_now equal 2.92919348098*2.843877166*${lz1}
variable volume_now equal 2.92919348098*2.843877166*2.843877166
variable v1 equal 2*${delta_pe}
variable v1 equal 2*0.00370292480056378
variable v2 equal ${up}*${up}*${volume_now}
variable v2 equal 0.03*${up}*${volume_now}
variable v2 equal 0.03*0.03*${volume_now}
variable v2 equal 0.03*0.03*23.6902545590801
variable v3 equal ${v1}/${v2}
variable v3 equal 0.00740584960112756/${v2}
variable v3 equal 0.00740584960112756/0.0213212291031721
variable c11 equal ${v3}*${eVAngs3_to_GPa}
variable c11 equal 0.347346279395579*${eVAngs3_to_GPa}
variable c11 equal 0.347346279395579*160.21766208

print "Components of the Elastic Constant Tensor"
Components of the Elastic Constant Tensor
print "========================================="
=========================================
print "Elastic Constant C11all = ${C11} ${cunits}"
Elastic Constant C11all = 50.1808721737943 GPa

print "C11 computed from the total energy is ${c11} ${cunits}"
C11 computed from the total energy is 55.6510088169461 GPa
print "========================================="
=========================================
Total wall time: 0:01:00
